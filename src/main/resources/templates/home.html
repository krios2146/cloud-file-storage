<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Home</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/upload.css}"/>
</head>
<body>

<div th:replace="component/header :: header"></div>

<div class="container-fluid">
    <div class="row">
        <!-- Left Pane -->
        <div class="col-md-2">

            <div aria-label="upload button group" class="btn-group-vertical" role="group">
                <button class="btn btn-primary mb-1" data-mdb-target="#fileUploadModal" data-mdb-toggle="modal"
                        type="button">
                    Upload file
                </button>
                <button class="btn btn-primary" data-mdb-target="#folderUploadModal" data-mdb-toggle="modal"
                        type="button">
                    Upload folder
                </button>
            </div>

        </div>
        <!-- Right Pane -->
        <div class="col-md-10">

            <!-- Breadcrumbs -->
            <nav aria-label="breadcrumb" th:if="${username}">
                <ol class="breadcrumb">
                    <li th:class="${iterStat.last ? 'breadcrumb-item active' : 'breadcrumb-item'}"
                        th:each="link, iterStat : ${breadcrumbLinks}"
                        th:if="${!#strings.isEmpty(link)}">
                        <a th:href="${'/?path=' + link}" th:text="${breadcrumbFolders[iterStat.index]}">Library</a>
                    </li>
                </ol>
            </nav>

        </div>
    </div>
</div>


<h2>Files</h2>
<ol th:if="${username}">
    <li th:each="file : ${files}">
        <div th:unless="${file.isDir}">
            <span th:text="${file.name}"></span>
            <form th:action="@{/files}" th:method="delete" th:object="${fileDeleteRequest}">
                <input th:name="path" th:value="${file.path}" type="hidden">
                <input th:name="owner" th:value="${username}" type="hidden">
                <button type="submit">Delete</button>
            </form>
            <form th:action="@{/files}" th:method="put" th:object="${fileRenameRequest}">
                <input th:name="currentName" th:value="${file.name}" type="hidden">
                <input required th:field="*{newName}" type="text">
                <input th:name="path" th:value="${file.path}" type="hidden">
                <input th:name="owner" th:value="${username}" type="hidden">
                <button type="submit">Rename</button>
            </form>
            <form th:action="@{/files}" th:method="get" th:object="${fileDownloadRequest}">
                <input th:name="path" th:value="${file.path}" type="hidden">
                <input th:name="owner" th:value="${username}" type="hidden">
                <input th:name="name" th:value="${file.name}" type="hidden">
                <button type="submit">Download</button>
            </form>
        </div>
        <div th:if="${file.isDir}">
            <a th:href="@{'/?path=' + ${file.path}}" th:text="${file.name}"></a>
            <form th:action="@{/folders}" th:method="delete" th:object="${folderDeleteRequest}">
                <input th:name="path" th:value="${file.path}" type="hidden">
                <input th:name="owner" th:value="${username}" type="hidden">
                <button type="submit">Delete</button>
            </form>
            <form th:action="@{/folders}" th:method="put" th:object="${folderRenameRequest}">
                <input th:name="currentName" th:value="${file.name}" type="hidden">
                <input required th:field="*{newName}" type="text">
                <input th:name="path" th:value="${file.path}" type="hidden">
                <input th:name="owner" th:value="${username}" type="hidden">
                <button type="submit">Rename</button>
            </form>
        </div>
    </li>
</ol>


<h2>Search</h2>
<form th:action="@{/search}" th:method="get">
    <input required th:name="query" type="text">
    <button type="submit">Search</button>
</form>

<!-- File Upload Modal -->
<div th:replace="component/upload-file-modal :: file-modal"></div>

<!-- Folder Upload Modal -->
<div th:replace="component/upload-folder-modal :: folder-modal"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.js" type="text/javascript"></script>
<script crossorigin="anonymous"
        integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE="
        src="https://code.jquery.com/jquery-3.7.0.slim.min.js"></script>
<script th:src="@{/js/upload.js}" type="text/javascript"></script>
</body>
</html>